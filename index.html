<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archives</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a2e;
            --accent: #0066cc;
            --accent-hover: #0052a3;
            --border: #e0e0e0;
            --tag-bg: #f0f0f0;
            --tag-active: #0066cc;
            --tag-active-text: #ffffff;
            --hover-bg: #f8f9fa;
            --shadow: rgba(0, 0, 0, 0.08);
            --muted: #666;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a2e;
                --text: #e0e0e0;
                --accent: #4da6ff;
                --accent-hover: #80bfff;
                --border: #2e2e4a;
                --tag-bg: #2e2e4a;
                --tag-active: #4da6ff;
                --tag-active-text: #1a1a2e;
                --hover-bg: #22223a;
                --shadow: rgba(0, 0, 0, 0.3);
                --muted: #999;
            }
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            line-height: 1.6;
        }

        h1 { font-size: 1.8rem; margin-bottom: 0.25rem; }

        .subtitle {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            background: var(--bg);
            color: var(--text);
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box:focus { border-color: var(--accent); }

        .sort-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            outline: none;
        }

        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 1.25rem;
        }

        .filter-tag {
            padding: 0.25rem 0.7rem;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            background: var(--tag-bg);
            color: var(--text);
            transition: all 0.2s;
            user-select: none;
        }

        .filter-tag:hover { border-color: var(--accent); }

        .filter-tag.active {
            background: var(--tag-active);
            color: var(--tag-active-text);
            border-color: var(--tag-active);
        }

        .file-list { list-style: none; }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.7rem 0.75rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        .file-item:first-child { border-top: 1px solid var(--border); }
        .file-item:hover { background: var(--hover-bg); }

        .file-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
            width: 1.5rem;
            text-align: center;
        }

        .file-info { flex: 1; min-width: 0; }

        .file-name {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            word-break: break-word;
        }

        .file-name:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .file-meta {
            font-size: 0.78rem;
            color: var(--muted);
            display: flex;
            gap: 1rem;
            margin-top: 0.15rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--accent);
            color: var(--accent);
        }

        .page-btn.active {
            background: var(--accent);
            color: var(--tag-active-text);
            border-color: var(--accent);
        }

        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .status {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
        }

        .status.error { color: #cc3333; }

        .result-count {
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 0.5rem;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-right: 0.5rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>üìÅ Saved Pages</h1>
    <p class="subtitle">shredthagnar/savedpages</p>

    <div class="controls hidden" id="controls">
        <input type="text" class="search-box" id="search" placeholder="Search files‚Ä¶ ( / )" autocomplete="off">
        <select class="sort-select" id="sort">
            <option value="name-asc">Name ‚Üë</option>
            <option value="name-desc">Name ‚Üì</option>
            <option value="size-asc">Size ‚Üë</option>
            <option value="size-desc">Size ‚Üì</option>
            <option value="type-asc">Type ‚Üë</option>
        </select>
    </div>

    <div class="filter-bar hidden" id="filters"></div>
    <p class="result-count hidden" id="result-count"></p>
    <ul class="file-list" id="file-list"></ul>
    <div class="pagination hidden" id="pagination"></div>
    <p class="status" id="status"><span class="spinner"></span>Loading‚Ä¶</p>

    <script>
        (() => {
            const PAGE_SIZE = 20;
            const ICONS = {
                pdf: "üìÑ", doc: "üìù", docx: "üìù", txt: "üìù", rtf: "üìù",
                jpg: "üñºÔ∏è", jpeg: "üñºÔ∏è", png: "üñºÔ∏è", gif: "üñºÔ∏è", svg: "üñºÔ∏è", webp: "üñºÔ∏è",
                mp3: "üéµ", wav: "üéµ", flac: "üéµ", ogg: "üéµ",
                mp4: "üé¨", avi: "üé¨", mkv: "üé¨", mov: "üé¨", webm: "üé¨",
                zip: "üì¶", rar: "üì¶", "7z": "üì¶", tar: "üì¶", gz: "üì¶",
                html: "üåê", htm: "üåê", css: "üé®", js: "‚öôÔ∏è",
                json: "üìã", xml: "üìã", csv: "üìã",
                md: "üìñ", mhtml: "üåê", mht: "üåê",
                _dir: "üìÇ", _default: "üìé"
            };

            const CATEGORIES = {
                "All": null,
                "Documents": ["pdf", "doc", "docx", "txt", "rtf", "md", "csv"],
                "Web": ["html", "htm", "mhtml", "mht", "css", "js"],
                "Images": ["jpg", "jpeg", "png", "gif", "svg", "webp"],
                "Audio": ["mp3", "wav", "flac", "ogg"],
                "Video": ["mp4", "avi", "mkv", "mov", "webm"],
                "Archives": ["zip", "rar", "7z", "tar", "gz"],
            };

            let allFiles = [];
            let currentPage = 1;
            let activeFilter = "All";

            const $ = id => document.getElementById(id);
            const statusEl = $("status");
            const listEl = $("file-list");
            const controlsEl = $("controls");
            const filtersEl = $("filters");
            const searchEl = $("search");
            const sortEl = $("sort");
            const paginationEl = $("pagination");
            const resultCountEl = $("result-count");

            function getExt(name) {
                const parts = name.split(".");
                return parts.length > 1 ? parts.pop().toLowerCase() : "";
            }

            function getIcon(file) {
                if (file.type === "dir") return ICONS._dir;
                return ICONS[getExt(file.name)] || ICONS._default;
            }

            function formatSize(bytes) {
                if (bytes == null) return "‚Äî";
                if (bytes === 0) return "0 B";
                const units = ["B", "KB", "MB", "GB"];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return (bytes / Math.pow(1024, i)).toFixed(i ? 1 : 0) + " " + units[i];
            }

            function getFilteredFiles() {
                const query = searchEl.value.toLowerCase().trim();
                return allFiles.filter(f => {
                    if (activeFilter !== "All") {
                        const catExts = CATEGORIES[activeFilter];
                        if (activeFilter === "Other") {
                            const inAnyCat = Object.values(CATEGORIES).some(exts => exts && exts.includes(getExt(f.name)));
                            if (inAnyCat || f.type === "dir") return false;
                        } else if (catExts && !catExts.includes(getExt(f.name))) {
                            return false;
                        }
                    }
                    if (query && !f.name.toLowerCase().includes(query)) return false;
                    return true;
                });
            }

            function sortFiles(files) {
                const [key, dir] = sortEl.value.split("-");
                const mult = dir === "desc" ? -1 : 1;
                return [...files].sort((a, b) => {
                    if (a.type === "dir" && b.type !== "dir") return -1;
                    if (a.type !== "dir" && b.type === "dir") return 1;
                    if (key === "name") return mult * a.name.localeCompare(b.name, undefined, { sensitivity: "base" });
                    if (key === "size") return mult * ((a.size || 0) - (b.size || 0));
                    if (key === "type") return mult * getExt(a.name).localeCompare(getExt(b.name));
                    return 0;
                });
            }

            function render() {
                const filtered = sortFiles(getFilteredFiles());
                const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
                if (currentPage > totalPages) currentPage = totalPages;
                const start = (currentPage - 1) * PAGE_SIZE;
                const pageFiles = filtered.slice(start, start + PAGE_SIZE);

                resultCountEl.textContent = `${filtered.length} file${filtered.length !== 1 ? "s" : ""} found`;
                resultCountEl.classList.remove("hidden");

                listEl.innerHTML = "";
                if (pageFiles.length === 0) {
                    listEl.innerHTML = `<li class="status">No files match your criteria.</li>`;
                } else {
                    for (const file of pageFiles) {
                        const li = document.createElement("li");
                        li.className = "file-item";

                        const icon = document.createElement("span");
                        icon.className = "file-icon";
                        icon.textContent = getIcon(file);

                        const info = document.createElement("div");
                        info.className = "file-info";

                        const link = document.createElement("a");
                        link.className = "file-name";
                        link.href = file.name + (file.type === "dir" ? "/" : "");
                        link.textContent = file.name;
                        if (file.type !== "dir") link.target = "_blank";

                        const meta = document.createElement("div");
                        meta.className = "file-meta";
                        const ext = getExt(file.name);
                        meta.innerHTML = [
                            ext ? `<span>${ext.toUpperCase()}</span>` : "",
                            file.type !== "dir" ? `<span>${formatSize(file.size)}</span>` : "<span>Directory</span>",
                        ].filter(Boolean).join("");

                        info.appendChild(link);
                        info.appendChild(meta);
                        li.appendChild(icon);
                        li.appendChild(info);
                        listEl.appendChild(li);
                    }
                }
                renderPagination(totalPages);
            }

            function renderPagination(totalPages) {
                paginationEl.innerHTML = "";
                if (totalPages <= 1) { paginationEl.classList.add("hidden"); return; }
                paginationEl.classList.remove("hidden");

                const addBtn = (label, page, disabled = false, active = false) => {
                    const btn = document.createElement("button");
                    btn.className = "page-btn" + (active ? " active" : "");
                    btn.textContent = label;
                    btn.disabled = disabled;
                    btn.addEventListener("click", () => { currentPage = page; render(); window.scrollTo({ top: 0, behavior: "smooth" }); });
                    paginationEl.appendChild(btn);
                };

                addBtn("‚Üê Prev", currentPage - 1, currentPage === 1);
                let pages = [];
                if (totalPages <= 7) {
                    pages = Array.from({ length: totalPages }, (_, i) => i + 1);
                } else {
                    pages = [1];
                    if (currentPage > 3) pages.push("‚Ä¶");
                    for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) pages.push(i);
                    if (currentPage < totalPages - 2) pages.push("‚Ä¶");
                    pages.push(totalPages);
                }
                for (const p of pages) {
                    if (p === "‚Ä¶") {
                        const span = document.createElement("span");
                        span.textContent = "‚Ä¶";
                        span.style.padding = "0 0.25rem";
                        paginationEl.appendChild(span);
                    } else {
                        addBtn(p, p, false, p === currentPage);
                    }
                }
                addBtn("Next ‚Üí", currentPage + 1, currentPage === totalPages);
            }

            function buildFilterBar() {
                const presentExts = new Set(allFiles.map(f => getExt(f.name)));
                filtersEl.innerHTML = "";
                for (const [cat, exts] of Object.entries(CATEGORIES)) {
                    if (cat !== "All" && exts && !exts.some(e => presentExts.has(e))) continue;
                    const tag = document.createElement("span");
                    tag.className = "filter-tag" + (activeFilter === cat ? " active" : "");
                    tag.textContent = cat;
                    tag.addEventListener("click", () => {
                        activeFilter = cat;
                        currentPage = 1;
                        buildFilterBar();
                        render();
                    });
                    filtersEl.appendChild(tag);
                }
                filtersEl.classList.remove("hidden");
            }

            let searchTimeout;
            searchEl.addEventListener("input", () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => { currentPage = 1; render(); }, 200);
            });
            sortEl.addEventListener("change", () => { currentPage = 1; render(); });

            document.addEventListener("keydown", (e) => {
                if (e.key === "/" && document.activeElement !== searchEl) { e.preventDefault(); searchEl.focus(); }
                if (e.key === "Escape") searchEl.blur();
            });

            // ‚îÄ‚îÄ Load from local files.json instead of GitHub API ‚îÄ‚îÄ
            (async () => {
                try {
                    const response = await fetch("files.json");

                    if (!response.ok) throw new Error("files.json not found. Push a change to trigger the GitHub Action.");

                    allFiles = await response.json();

                    if (allFiles.length === 0) {
                        statusEl.textContent = "This directory is empty.";
                        return;
                    }

                    statusEl.classList.add("hidden");
                    controlsEl.classList.remove("hidden");
                    buildFilterBar();
                    render();
                } catch (e) {
                    statusEl.innerHTML = `‚ùå ${e.message}`;
                    statusEl.classList.add("error");
                }
            })();
        })();
    </script>
</body>
</html>
