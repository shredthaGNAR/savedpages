﻿<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archives</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a2e;
            --accent: #0066cc;
            --accent-hover: #0052a3;
            --border: #e0e0e0;
            --tag-bg: #f0f0f0;
            --tag-active: #0066cc;
            --tag-active-text: #ffffff;
            --hover-bg: #f8f9fa;
            --shadow: rgba(0, 0, 0, 0.08);
            --muted: #666;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a2e;
                --text: #e0e0e0;
                --accent: #4da6ff;
                --accent-hover: #80bfff;
                --border: #2e2e4a;
                --tag-bg: #2e2e4a;
                --tag-active: #4da6ff;
                --tag-active-text: #1a1a2e;
                --hover-bg: #22223a;
                --shadow: rgba(0, 0, 0, 0.3);
                --muted: #999;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            line-height: 1.6;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            background: var(--bg);
            color: var(--text);
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            border-color: var(--accent);
        }

        .sort-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            outline: none;
        }

        /* Filter Tags */
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 1.25rem;
        }

        .filter-tag {
            padding: 0.25rem 0.7rem;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            background: var(--tag-bg);
            color: var(--text);
            transition: all 0.2s;
            user-select: none;
        }

        .filter-tag:hover {
            border-color: var(--accent);
        }

        .filter-tag.active {
            background: var(--tag-active);
            color: var(--tag-active-text);
            border-color: var(--tag-active);
        }

        /* File List */
        .file-list {
            list-style: none;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.7rem 0.75rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        .file-item:first-child {
            border-top: 1px solid var(--border);
        }

        .file-item:hover {
            background: var(--hover-bg);
        }

        .file-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
            width: 1.5rem;
            text-align: center;
        }

        .file-info {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            word-break: break-word;
        }

        .file-name:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .file-meta {
            font-size: 0.78rem;
            color: var(--muted);
            display: flex;
            gap: 1rem;
            margin-top: 0.15rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--accent);
            color: var(--accent);
        }

        .page-btn.active {
            background: var(--accent);
            color: var(--tag-active-text);
            border-color: var(--accent);
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Status */
        .status {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
        }

        .status.error {
            color: #cc3333;
        }

        .result-count {
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 0.5rem;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>📁 Archives</h1>
    <p class="subtitle" id="subtitle"></p>

    <div class="controls hidden" id="controls">
        <input type="text" class="search-box" id="search" placeholder="Search files…" autocomplete="off">
        <select class="sort-select" id="sort">
            <option value="name-asc">Name ↑</option>
            <option value="name-desc">Name ↓</option>
            <option value="size-asc">Size ↑</option>
            <option value="size-desc">Size ↓</option>
            <option value="type-asc">Type ↑</option>
        </select>
    </div>

    <div class="filter-bar hidden" id="filters"></div>
    <p class="result-count hidden" id="result-count"></p>
    <ul class="file-list" id="file-list"></ul>
    <div class="pagination hidden" id="pagination"></div>
    <p class="status" id="status"><span class="spinner"></span>Loading file list…</p>

    <script>
        (() => {
            // ── Config ──
            const PAGE_SIZE = 20;
            const ICONS = {
                pdf: "📄", doc: "📝", docx: "📝", txt: "📝", rtf: "📝",
                jpg: "🖼️", jpeg: "🖼️", png: "🖼️", gif: "🖼️", svg: "🖼️", webp: "🖼️", bmp: "🖼️", ico: "🖼️",
                mp3: "🎵", wav: "🎵", flac: "🎵", ogg: "🎵", aac: "🎵", wma: "🎵",
                mp4: "🎬", avi: "🎬", mkv: "🎬", mov: "🎬", wmv: "🎬", webm: "🎬",
                zip: "📦", rar: "📦", "7z": "📦", tar: "📦", gz: "📦",
                html: "🌐", htm: "🌐", css: "🎨", js: "⚙️", ts: "⚙️",
                json: "📋", xml: "📋", csv: "📋", yaml: "📋", yml: "📋",
                py: "🐍", rb: "💎", java: "☕", c: "⚙️", cpp: "⚙️", rs: "🦀", go: "🐹",
                md: "📖", exe: "💻", sh: "🖥️", bat: "🖥️",
                _dir: "📂", _default: "📎"
            };

            const CATEGORIES = {
                "All": null,
                "Documents": ["pdf", "doc", "docx", "txt", "rtf", "md", "csv"],
                "Images": ["jpg", "jpeg", "png", "gif", "svg", "webp", "bmp", "ico"],
                "Audio": ["mp3", "wav", "flac", "ogg", "aac", "wma"],
                "Video": ["mp4", "avi", "mkv", "mov", "wmv", "webm"],
                "Code": ["html", "htm", "css", "js", "ts", "json", "xml", "yaml", "yml", "py", "rb", "java", "c", "cpp", "rs", "go", "sh", "bat"],
                "Archives": ["zip", "rar", "7z", "tar", "gz"],
            };

            // ── State ──
            let allFiles = [];
            let currentPage = 1;
            let activeFilter = "All";

            // ── DOM Refs ──
            const $ = id => document.getElementById(id);
            const statusEl = $("status");
            const listEl = $("file-list");
            const controlsEl = $("controls");
            const filtersEl = $("filters");
            const searchEl = $("search");
            const sortEl = $("sort");
            const paginationEl = $("pagination");
            const resultCountEl = $("result-count");
            const subtitleEl = $("subtitle");

            // ── Helpers ──
            function getExt(name) {
                const parts = name.split(".");
                return parts.length > 1 ? parts.pop().toLowerCase() : "";
            }

            function getIcon(file) {
                if (file.type === "dir") return ICONS._dir;
                return ICONS[getExt(file.name)] || ICONS._default;
            }

            function formatSize(bytes) {
                if (bytes == null) return "—";
                if (bytes === 0) return "0 B";
                const units = ["B", "KB", "MB", "GB"];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return (bytes / Math.pow(1024, i)).toFixed(i ? 1 : 0) + " " + units[i];
            }

            function getCategory(file) {
                if (file.type === "dir") return "Folder";
                const ext = getExt(file.name);
                for (const [cat, exts] of Object.entries(CATEGORIES)) {
                    if (exts && exts.includes(ext)) return cat;
                }
                return "Other";
            }

            // ── Filtering, Sorting, Searching ──
            function getFilteredFiles() {
                const query = searchEl.value.toLowerCase().trim();
                return allFiles.filter(f => {
                    if (activeFilter !== "All") {
                        const catExts = CATEGORIES[activeFilter];
                        if (activeFilter === "Other") {
                            const inAnyCat = Object.values(CATEGORIES).some(exts => exts && exts.includes(getExt(f.name)));
                            if (inAnyCat || f.type === "dir") return false;
                        } else if (catExts && !catExts.includes(getExt(f.name))) {
                            return false;
                        }
                    }
                    if (query && !f.name.toLowerCase().includes(query)) return false;
                    return true;
                });
            }

            function sortFiles(files) {
                const [key, dir] = sortEl.value.split("-");
                const mult = dir === "desc" ? -1 : 1;
                return [...files].sort((a, b) => {
                    // Directories always first
                    if (a.type === "dir" && b.type !== "dir") return -1;
                    if (a.type !== "dir" && b.type === "dir") return 1;

                    if (key === "name") return mult * a.name.localeCompare(b.name, undefined, { sensitivity: "base" });
                    if (key === "size") return mult * ((a.size || 0) - (b.size || 0));
                    if (key === "type") return mult * getExt(a.name).localeCompare(getExt(b.name));
                    return 0;
                });
            }

            // ── Rendering ──
            function render() {
                const filtered = sortFiles(getFilteredFiles());
                const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
                if (currentPage > totalPages) currentPage = totalPages;
                const start = (currentPage - 1) * PAGE_SIZE;
                const pageFiles = filtered.slice(start, start + PAGE_SIZE);

                // Result count
                resultCountEl.textContent = `${filtered.length} file${filtered.length !== 1 ? "s" : ""} found`;
                resultCountEl.classList.remove("hidden");

                // File list
                listEl.innerHTML = "";
                if (pageFiles.length === 0) {
                    listEl.innerHTML = `<li class="status">No files match your criteria.</li>`;
                } else {
                    for (const file of pageFiles) {
                        const li = document.createElement("li");
                        li.className = "file-item";

                        const icon = document.createElement("span");
                        icon.className = "file-icon";
                        icon.textContent = getIcon(file);

                        const info = document.createElement("div");
                        info.className = "file-info";

                        const link = document.createElement("a");
                        link.className = "file-name";
                        link.href = file.name + (file.type === "dir" ? "/" : "");
                        link.textContent = file.name;
                        if (file.type !== "dir") link.target = "_blank";

                        const meta = document.createElement("div");
                        meta.className = "file-meta";
                        const ext = getExt(file.name);
                        meta.innerHTML = [
                            ext ? `<span>${ext.toUpperCase()}</span>` : "",
                            file.type !== "dir" ? `<span>${formatSize(file.size)}</span>` : "<span>Directory</span>",
                        ].filter(Boolean).join("");

                        info.appendChild(link);
                        info.appendChild(meta);
                        li.appendChild(icon);
                        li.appendChild(info);
                        listEl.appendChild(li);
                    }
                }

                // Pagination
                renderPagination(totalPages);
            }

            function renderPagination(totalPages) {
                paginationEl.innerHTML = "";
                if (totalPages <= 1) {
                    paginationEl.classList.add("hidden");
                    return;
                }
                paginationEl.classList.remove("hidden");

                const addBtn = (label, page, disabled = false, active = false) => {
                    const btn = document.createElement("button");
                    btn.className = "page-btn" + (active ? " active" : "");
                    btn.textContent = label;
                    btn.disabled = disabled;
                    btn.addEventListener("click", () => { currentPage = page; render(); window.scrollTo({ top: 0, behavior: "smooth" }); });
                    paginationEl.appendChild(btn);
                };

                addBtn("← Prev", currentPage - 1, currentPage === 1);

                // Smart page range
                let pages = [];
                if (totalPages <= 7) {
                    pages = Array.from({ length: totalPages }, (_, i) => i + 1);
                } else {
                    pages = [1];
                    if (currentPage > 3) pages.push("…");
                    for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
                        pages.push(i);
                    }
                    if (currentPage < totalPages - 2) pages.push("…");
                    pages.push(totalPages);
                }

                for (const p of pages) {
                    if (p === "…") {
                        const span = document.createElement("span");
                        span.textContent = "…";
                        span.style.padding = "0 0.25rem";
                        paginationEl.appendChild(span);
                    } else {
                        addBtn(p, p, false, p === currentPage);
                    }
                }

                addBtn("Next →", currentPage + 1, currentPage === totalPages);
            }

            function buildFilterBar() {
                // Detect which categories actually exist in our files
                const presentCategories = new Set();
                for (const f of allFiles) {
                    presentCategories.add(getCategory(f));
                }

                filtersEl.innerHTML = "";
                for (const cat of Object.keys(CATEGORIES)) {
                    if (cat !== "All" && !presentCategories.has(cat)) continue;
                    const tag = document.createElement("span");
                    tag.className = "filter-tag" + (activeFilter === cat ? " active" : "");
                    tag.textContent = cat;
                    tag.addEventListener("click", () => {
                        activeFilter = cat;
                        currentPage = 1;
                        buildFilterBar();
                        render();
                    });
                    filtersEl.appendChild(tag);
                }

                // "Other" tag if there are uncategorized files
                if (presentCategories.has("Other")) {
                    const tag = document.createElement("span");
                    tag.className = "filter-tag" + (activeFilter === "Other" ? " active" : "");
                    tag.textContent = "Other";
                    tag.addEventListener("click", () => {
                        activeFilter = "Other";
                        currentPage = 1;
                        buildFilterBar();
                        render();
                    });
                    filtersEl.appendChild(tag);
                }

                filtersEl.classList.remove("hidden");
            }

            // ── Event Listeners ──
            let searchTimeout;
            searchEl.addEventListener("input", () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => { currentPage = 1; render(); }, 200);
            });

            sortEl.addEventListener("change", () => { currentPage = 1; render(); });

            // ── Keyboard shortcut: focus search with / ──
            document.addEventListener("keydown", (e) => {
                if (e.key === "/" && document.activeElement !== searchEl) {
                    e.preventDefault();
                    searchEl.focus();
                }
                if (e.key === "Escape") searchEl.blur();
            });

            // ── Init ──
            (async () => {
                try {
                    const match = location.hostname.match(/(.*)\.github\.io/);
                    if (!match) throw new Error("This page only works on GitHub Pages (*.github.io)");

                    const user = match[1];
                    const pathMatch = location.pathname.match(/\/.*\//);
                    const path = pathMatch ? pathMatch[0] : "/";

                    subtitleEl.textContent = `${user}${path}`;

                    const response = await fetch(`https://api.github.com/repos/${user}${path}contents/`);

                    if (response.status === 403) throw new Error("GitHub API rate limit exceeded. Try again later.");
                    if (response.status === 404) throw new Error("Repository or path not found.");
                    if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);

                    const files = await response.json();

                    if (!Array.isArray(files)) throw new Error("Unexpected API response.");

                    allFiles = files.filter(f => f.name !== "index.html");

                    if (allFiles.length === 0) {
                        statusEl.textContent = "This directory is empty.";
                        return;
                    }

                    statusEl.classList.add("hidden");
                    controlsEl.classList.remove("hidden");
                    buildFilterBar();
                    render();

                } catch (e) {
                    statusEl.innerHTML = `❌ ${e.message}`;
                    statusEl.classList.add("error");
                }
            })();
        })();
    </script>
</body>
</html>
